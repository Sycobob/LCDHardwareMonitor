#include "../src/Outline.ps.h"

Texture2D srcTex;
SamplerState samplerState;

struct PixelFragment
{
	float4 PosH  : SV_POSITION;
	float4 Color : COLOR;
	float2 UV    : TEXCOORD;
};

float4 main(PixelFragment pIn) : SV_TARGET
{
	int blurRadius = 6;
	float slope = -1.0 / (blurRadius + 1);    // Alpha falloff rate
	float scale = 1.0 / ((slope * 2.25) + 1); // Saturate the first few pixels
	float2 texelStep = 1.0 / textureSize * blurDirection;

	float maxAlpha = 0;
	for (int i = 1; i <= blurRadius; i++)
	{
		float src1 = srcTex.Sample(samplerState, pIn.UV + (i * texelStep)).a;
		float src2 = srcTex.Sample(samplerState, pIn.UV - (i * texelStep)).a;
		float src = max(src1, src2);

		float dist = i;
		float alpha = saturate(scale * ((slope * dist) + 1)) * src;
		maxAlpha = max(maxAlpha, alpha);
	}

	return float4(1, 1, 1, maxAlpha);
}
